<!--
  Visual editor main toolbar component
  Unified management of public toolbars and renderer-specific toolbars
-->
<script setup lang="ts">
import { computed, ref, onMounted, onBeforeUnmount } from 'vue'
import {
  NModal,
  useThemeVars,
  NSpace,
  NButton,
  NSelect,
  NDivider,
  NPopconfirm,
  NTooltip,
  NForm,
  NFormItem,
  NInputNumber,
  NSwitch,
  NColorPicker,
  NSlider,
  useMessage,
  type FormInst
} from 'naive-ui'
import CommonToolbar from './CommonToolbar.vue'
import SvgIcon from '@/components/custom/svg-icon.vue'
import { $t } from '@/locales'
import DataSourceTriggerPanel from '../DataSourceTriggerPanel.vue'

interface Props {
  mode: 'edit' | 'preview'
  currentRenderer: string
  availableRenderers: Array<{ value: string; label: string; icon?: string }>
  canvasConfig?: Record<string, any>
  gridstackConfig?: Record<string, any>
  visualizationConfig?: Record<string, any>
  readonly?: boolean
  isSaving?: boolean
  hasChanges?: boolean
  showLeftDrawer?: boolean
  showRightDrawer?: boolean
}

interface Emits {
  // Edit status control
  (e: 'mode-change', mode: 'edit' | 'preview'): void
  (e: 'renderer-change', rendererId: string): void
  // Document operations
  (e: 'save'): void
  (e: 'import'): void
  (e: 'export'): void
  (e: 'import-config', config: Record<string, any>): void
  (e: 'export-config'): void
  // Edit operations
  (e: 'undo'): void
  (e: 'redo'): void
  (e: 'clear-all'): void
  // View control
  (e: 'zoom-in'): void
  (e: 'zoom-out'): void
  (e: 'reset-zoom'): void
  (e: 'fit-content'): void
  (e: 'center-view'): void
  (e: 'preview-mode'): void
  // Panel configuration
  (e: 'open-config'): void
  (e: 'toggle-left-drawer'): void
  (e: 'toggle-right-drawer'): void
  // Configuration changes
  (e: 'canvas-config-change', config: Record<string, any>): void
  (e: 'gridstack-config-change', config: Record<string, any>): void
}

const props = withDefaults(defineProps<Props>(), {
  readonly: false,
  canvasConfig: () => ({}),
  gridstackConfig: () => ({}),
  visualizationConfig: () => ({}),
  isSaving: false,
  hasChanges: false,
  showLeftDrawer: false,
  showRightDrawer: false
})

const emit = defineEmits<Emits>()

// Configuration panel display status
const showConfigPanel = ref(false)
// Data source trigger panel display status
const showDataSourcePanel = ref(false)

// Message prompt
const message = useMessage()

// Custom row height status
const customRowHeight = ref<number>(80)
const isCustomRowHeight = computed(() => {
  return !rowHeightOptions.slice(0, -1).some(option => option.value === gridstackConfig.value.rowHeight)
})

// Theme support - useNaive UItheme system
const themeVars = useThemeVars()
const toolbarColors = computed(() => ({
  '--toolbar-bg': themeVars.value.bodyColor,
  '--toolbar-border': themeVars.value.dividerColor,
  '--toolbar-shadow': themeVars.value.boxShadow2,
  '--modal-bg': themeVars.value.modalColor,
  '--modal-header-bg': themeVars.value.cardColor,
  '--modal-content-bg': themeVars.value.bodyColor,
  '--modal-border': themeVars.value.borderColor,
  '--modal-header-border': themeVars.value.dividerColor
}))

// Determine the current renderer type
const isCanvasRenderer = computed(() => props.currentRenderer === 'canvas')
const isGridstackRenderer = computed(() => props.currentRenderer === 'gridstack')
const isVisualizationRenderer = computed(() => props.currentRenderer === 'visualization')

// Grid column number default options
const columnOptions = [
  { label: '12List - Standard small grid', value: 12 },
  { label: '24List - standard grid', value: 24 },
  { label: '48List - large grid', value: 48 },
  { label: '60List - ultra-dense grid', value: 60 },
  { label: '72List - High density grid', value: 72 },
  { label: '84List - ultra high density grid', value: 84 },
  { label: '96List - Ultimate Grid', value: 96 }
]

// Line height default options
const rowHeightOptions = [
  { label: 'compact - 30px', value: 30 },
  { label: 'Small - 50px', value: 50 },
  { label: 'standard - 80px', value: 80 },
  { label: 'Loose - 120px', value: 120 },
  { label: 'super loose - 150px', value: 150 },
  { label: 'Customize', value: -1 }
]

// Calculate current configurationï¼ˆProvide default valueï¼‰
const canvasConfig = computed(() => ({
  width: 1200,
  height: 800,
  showGrid: true,
  backgroundColor: '#f5f5f5',
  gridSize: 20,
  ...props.canvasConfig
}))

const gridstackConfig = computed(() => ({
  colNum: 12,
  rowHeight: 80,
  margin: [10, 10],
  isDraggable: true,
  isResizable: true,
  staticGrid: false,
  ...props.gridstackConfig
}))

const visualizationConfig = computed(() => ({
  theme: 'default',
  animation: true,
  responsive: true,
  ...props.visualizationConfig
}))

// Edit status control
const handleModeChange = (mode: 'edit' | 'preview') => {
  emit('mode-change', mode)
}
const handleRendererChange = (rendererId: string) => emit('renderer-change', rendererId)

// Document operations
const handleSave = () => emit('save')

// Edit operations
const handleUndo = () => emit('undo')
const handleRedo = () => emit('redo')
const handleClearAll = () => emit('clear-all')

// Renderer configuration changes
const handleCanvasConfigChange = (config: Record<string, any>) => {
  emit('canvas-config-change', config)
}

const handleGridstackConfigChange = (config: Record<string, any>) => {
  emit('gridstack-config-change', config)
}

const handleVisualizationConfigChange = (config: Record<string, any>) => {
  emit('visualization-config-change', config)
}

// view control events
const handleZoomIn = () => emit('zoom-in')
const handleZoomOut = () => emit('zoom-out')
const handleResetZoom = () => emit('reset-zoom')
const handleFitContent = () => emit('fit-content')
const handleCenterView = () => emit('center-view')

// Drawer control event
const handleToggleLeftDrawer = () => emit('toggle-left-drawer')
const handleToggleRightDrawer = () => emit('toggle-right-drawer')

// Switch configuration panel display status
const handleToggleRendererConfig = () => {
  showConfigPanel.value = !showConfigPanel.value
}

// ðŸš¨ ESCkey to close the pop-up window - Alternate mask layer click
const handleKeyDown = (event: KeyboardEvent) => {
  if (event.key === 'Escape' && showConfigPanel.value) {
    showConfigPanel.value = false
  }
}

// Listen for keyboard events
onMounted(() => {
  document.addEventListener('keydown', handleKeyDown)
})

onBeforeUnmount(() => {
  document.removeEventListener('keydown', handleKeyDown)
})

// Toggle data source trigger panel display state
const handleToggleDataSourcePanel = () => {
  showDataSourcePanel.value = !showDataSourcePanel.value
}

// File import and export processing
const fileInputRef = ref<HTMLInputElement>()

const handleImport = () => {
  // Create a hidden file input element
  if (!fileInputRef.value) {
    const input = document.createElement('input')
    input.type = 'file'
    input.accept = '.json'
    input.style.display = 'none'
    input.addEventListener('change', e => {
      const file = (e.target as HTMLInputElement).files?.[0]
      if (file) {
        const reader = new FileReader()
        reader.onload = event => {
          try {
            const config = JSON.parse(event.target?.result as string)
            emit('import-config', config)
          } catch (error) {}
        }
        reader.readAsText(file)
      }
    })
    fileInputRef.value = input
    document.body.appendChild(input)
  }
  fileInputRef.value.click()
}

const handleExport = () => {
  // trigger export eventï¼ŒThe current configuration is provided by the parent component
  emit('export-config')
}

// Get configuration panel title
const getConfigTitle = () => {
  if (isCanvasRenderer.value) {
    return $t('visualEditor.canvasConfig')
  } else if (isGridstackRenderer.value) {
    return $t('visualEditor.gridConfig')
  } else if (isVisualizationRenderer.value) {
    return $t('visualEditor.visualizationConfig')
  }
  return $t('visualEditor.rendererConfig')
}
</script>

<template>
  <div class="visual-editor-toolbar h-12 flex items-center relative" :style="toolbarColors">
    <!-- left sideï¼šAdd component -->
    <div class="toolbar-left flex items-center gap-2">
      <!-- Add component button - Only shown in edit mode -->
      <template v-if="mode === 'edit'">
        <NButton size="small" :type="showLeftDrawer ? 'primary' : 'default'" @click="handleToggleLeftDrawer">
          <template #icon>
            <SvgIcon icon="material-symbols:widgets-outline" />
          </template>
          {{ $t('visualEditor.addComponent') }}
        </NButton>

        <!-- Renderer selection -->
        <NDivider vertical />
        <span class="text-12px text-gray-500">{{ $t('visualEditor.renderer') }}:</span>
        <NSelect
          :value="currentRenderer"
          :options="availableRenderers"
          size="small"
          style="width: 100px"
          @update:value="handleRendererChange"
        />
      </template>
    </div>

    <!-- right sideï¼šAction button group -->
    <div class="toolbar-right flex items-center">
      <NSpace align="center" :size="4">
        <!-- Functions in edit mode -->
        <template v-if="mode === 'edit'">
          <!-- Document Action Group -->
          <div class="btn-group">
            <NTooltip trigger="hover">
              <template #trigger>
                <NButton
                  size="small"
                  :type="hasChanges ? 'primary' : 'default'"
                  :loading="isSaving"
                  :disabled="readonly || isCanvasRenderer"
                  @click="handleSave"
                >
                  <template #icon>
                    <SvgIcon icon="material-symbols:save-outline" />
                  </template>
                </NButton>
              </template>
              <span v-if="isCanvasRenderer">CanvasFunction under developmentï¼ŒSaving is not supported yet</span>
              <span v-else>{{ $t('visualEditor.shortcuts.save') }}</span>
            </NTooltip>

            <NButton size="small" type="tertiary" :disabled="readonly" @click="handleImport">
              <template #icon>
                <SvgIcon icon="material-symbols:upload" />
              </template>
            </NButton>

            <NButton size="small" type="tertiary" @click="handleExport">
              <template #icon>
                <SvgIcon icon="material-symbols:download" />
              </template>
            </NButton>
          </div>

          <!-- Edit action group -->
          <div class="btn-group">
            <NTooltip trigger="hover">
              <template #trigger>
                <NButton size="small" type="tertiary" :disabled="readonly" @click="handleUndo">
                  <template #icon>
                    <SvgIcon icon="material-symbols:undo" />
                  </template>
                </NButton>
              </template>
              <span>{{ $t('visualEditor.shortcuts.undo') }}</span>
            </NTooltip>

            <NTooltip trigger="hover">
              <template #trigger>
                <NButton size="small" type="tertiary" :disabled="readonly" @click="handleRedo">
                  <template #icon>
                    <SvgIcon icon="material-symbols:redo" />
                  </template>
                </NButton>
              </template>
              <span>{{ $t('visualEditor.shortcuts.redo') }}</span>
            </NTooltip>

            <NPopconfirm
              :positive-text="$t('visualEditor.confirm')"
              :negative-text="$t('visualEditor.cancel')"
              @positive-click="handleClearAll"
            >
              <template #trigger>
                <NButton size="small" type="error" secondary :disabled="readonly">
                  <template #icon>
                    <SvgIcon icon="material-symbols:delete-outline" />
                  </template>
                </NButton>
              </template>
              <span>{{ $t('visualEditor.clearAllConfirm') }}</span>
            </NPopconfirm>
          </div>

          <!-- Canvasview control group - onlyCanvasMode display -->
          <div v-if="isCanvasRenderer" class="btn-group">
            <NTooltip trigger="hover">
              <template #trigger>
                <NButton size="small" type="tertiary" @click="handleZoomOut">
                  <template #icon>
                    <SvgIcon icon="material-symbols:zoom-out" />
                  </template>
                </NButton>
              </template>
              <span>{{ $t('visualEditor.zoomOut') }}</span>
            </NTooltip>

            <NTooltip trigger="hover">
              <template #trigger>
                <NButton size="small" type="tertiary" @click="handleResetZoom">
                  <template #icon>
                    <SvgIcon icon="material-symbols:refresh" />
                  </template>
                </NButton>
              </template>
              <span>{{ $t('visualEditor.reset') }}</span>
            </NTooltip>

            <NTooltip trigger="hover">
              <template #trigger>
                <NButton size="small" type="tertiary" @click="handleZoomIn">
                  <template #icon>
                    <SvgIcon icon="material-symbols:zoom-in" />
                  </template>
                </NButton>
              </template>
              <span>{{ $t('visualEditor.zoomIn') }}</span>
            </NTooltip>
          </div>

          <!-- Configure button -->
          <NButton size="small" type="tertiary" @click="handleToggleRendererConfig">
            <template #icon>
              <SvgIcon icon="material-symbols:settings-outline" />
            </template>
          </NButton>

          <!-- Data source trigger management button -->
          <NTooltip trigger="hover">
            <template #trigger>
              <NButton size="small" type="info" @click="handleToggleDataSourcePanel">
                <template #icon>
                  <SvgIcon icon="material-symbols:data-usage-outline" />
                </template>
              </NButton>
            </template>
            <span>{{ $t('dataSource.trigger.management') }}</span>
          </NTooltip>
        </template>

        <!-- edit/Preview toggle button - Always shown on the far right -->
        <NDivider vertical />
        <NButton
          size="small"
          :type="mode === 'edit' ? 'primary' : 'default'"
          @click="handleModeChange(mode === 'edit' ? 'preview' : 'edit')"
        >
          <template #icon>
            <SvgIcon
              :icon="mode === 'edit' ? 'material-symbols:visibility-outline' : 'material-symbols:edit-outline'"
            />
          </template>
          {{ mode === 'edit' ? $t('visualEditor.preview') : $t('visualEditor.edit') }}
          <!-- debugging information -->
          <span style="font-size: 10px; margin-left: 4px">({{ mode }})</span>
        </NButton>
      </NSpace>
    </div>

    <!-- Renderer configuration panel - Simple translucent pop-up window -->
    <Teleport to="body">
      <div 
        v-if="showConfigPanel" 
        class="config-modal-overlay"
        @click.self="showConfigPanel = false"
      >
        <div class="config-modal-container">
          <!-- head -->
          <div class="config-modal-header">
            <h3>{{ getConfigTitle() }}</h3>
            <button class="close-btn" @click="showConfigPanel = false">Ã—</button>
          </div>
          
          <!-- content -->
          <div class="config-modal-body">
        <!-- Canvas Renderer configuration -->
        <div v-if="isCanvasRenderer" class="canvas-config">
          <NForm label-placement="left" label-width="100">
            <NFormItem :label="$t('visualEditor.canvasWidth')">
              <NInputNumber
                v-model:value="canvasConfig.width"
                :min="800"
                :max="4000"
                :step="100"
                placeholder="canvas width"
                @update:value="handleCanvasConfigChange({ ...canvasConfig, width: $event })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.canvasHeight')">
              <NInputNumber
                v-model:value="canvasConfig.height"
                :min="600"
                :max="3000"
                :step="100"
                placeholder="canvas height"
                @update:value="handleCanvasConfigChange({ ...canvasConfig, height: $event })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.showGrid')">
              <NSwitch
                v-model:value="canvasConfig.showGrid"
                @update:value="handleCanvasConfigChange({ ...canvasConfig, showGrid: $event })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.backgroundColor')">
              <NColorPicker
                v-model:value="canvasConfig.backgroundColor"
                @update:value="handleCanvasConfigChange({ ...canvasConfig, backgroundColor: $event })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.gridSize')">
              <NInputNumber
                v-model:value="canvasConfig.gridSize"
                :min="10"
                :max="50"
                :step="5"
                placeholder="grid size"
                @update:value="handleCanvasConfigChange({ ...canvasConfig, gridSize: $event })"
              />
            </NFormItem>
          </NForm>
        </div>

        <!-- Gridstack Renderer configuration -->
        <div v-else-if="isGridstackRenderer" class="gridstack-config">
          <NForm label-placement="left" label-width="100">
            <!-- Grid basic configuration -->
            <NDivider title-placement="left" style="margin: 12px 0">
              <span class="text-14px font-medium text-gray-600">Grid basic configuration</span>
            </NDivider>
            <NFormItem :label="$t('visualEditor.columns')">
              <NSelect
                :value="gridstackConfig.colNum"
                :options="columnOptions"
                placeholder="Select the number of grid columns"
                @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, colNum: value })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.rowHeight')">
              <NSpace vertical size="small">
                <NSelect
                  :value="isCustomRowHeight ? -1 : gridstackConfig.rowHeight"
                  :options="rowHeightOptions"
                  placeholder="Select row height"
                  @update:value="value => {
                    if (value === -1) {
                      customRowHeight = gridstackConfig.rowHeight
                    } else {
                      handleGridstackConfigChange({ ...gridstackConfig, rowHeight: value })
                    }
                  }"
                />
                <NInputNumber
                  v-if="isCustomRowHeight"
                  :value="gridstackConfig.rowHeight"
                  :min="20"
                  :max="300"
                  :step="10"
                  placeholder="Custom row height"
                  @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, rowHeight: value })"
                >
                  <template #suffix>px</template>
                </NInputNumber>
              </NSpace>
            </NFormItem>

            <NFormItem :label="$t('visualEditor.horizontalMargin')">
              <NSpace align="center" size="medium">
                <NSlider
                  :value="gridstackConfig.margin[0]"
                  :min="0"
                  :max="50"
                  :step="2"
                  style="flex: 1; min-width: 100px"
                  @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, margin: [value, gridstackConfig.margin[1]] })"
                />
                <NInputNumber
                  :value="gridstackConfig.margin[0]"
                  :min="0"
                  :max="50"
                  :step="2"
                  size="small"
                  style="width: 80px"
                  @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, margin: [value, gridstackConfig.margin[1]] })"
                >
                  <template #suffix>px</template>
                </NInputNumber>
              </NSpace>
            </NFormItem>

            <NFormItem :label="$t('visualEditor.verticalMargin')">
              <NSpace align="center" size="medium">
                <NSlider
                  :value="gridstackConfig.margin[1]"
                  :min="0"
                  :max="50"
                  :step="2"
                  style="flex: 1; min-width: 100px"
                  @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, margin: [gridstackConfig.margin[0], value] })"
                />
                <NInputNumber
                  :value="gridstackConfig.margin[1]"
                  :min="0"
                  :max="50"
                  :step="2"
                  size="small"
                  style="width: 80px"
                  @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, margin: [gridstackConfig.margin[0], value] })"
                >
                  <template #suffix>px</template>
                </NInputNumber>
              </NSpace>
            </NFormItem>

            <!-- Interactive behavior configuration -->
            <NDivider title-placement="left" style="margin: 16px 0 12px 0">
              <span class="text-14px font-medium text-gray-600">Interactive behavior configuration</span>
            </NDivider>

            <NFormItem :label="$t('visualEditor.draggable')">
              <NSwitch
                :value="gridstackConfig.isDraggable"
                @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, isDraggable: value })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.resizable')">
              <NSwitch
                :value="gridstackConfig.isResizable"
                @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, isResizable: value })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.staticGrid')">
              <NSwitch
                :value="gridstackConfig.staticGrid"
                @update:value="value => handleGridstackConfigChange({ ...gridstackConfig, staticGrid: value })"
              />
            </NFormItem>
          </NForm>
        </div>

        <!-- Visual renderer configuration -->
        <div v-else-if="isVisualizationRenderer" class="visualization-config">
          <NForm label-placement="left" label-width="100">
            <NFormItem :label="$t('visualEditor.theme')">
              <NSelect
                v-model:value="visualizationConfig.theme"
                :options="[
                  { label: $t('visualEditor.defaultTheme'), value: 'default' },
                  { label: $t('visualEditor.darkTheme'), value: 'dark' },
                  { label: $t('visualEditor.lightTheme'), value: 'light' }
                ]"
                placeholder="Select theme"
                @update:value="handleVisualizationConfigChange({ ...visualizationConfig, theme: $event })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.animation')">
              <NSwitch
                v-model:value="visualizationConfig.animation"
                @update:value="handleVisualizationConfigChange({ ...visualizationConfig, animation: $event })"
              />
            </NFormItem>

            <NFormItem :label="$t('visualEditor.responsive')">
              <NSwitch
                v-model:value="visualizationConfig.responsive"
                @update:value="handleVisualizationConfigChange({ ...visualizationConfig, responsive: $event })"
              />
            </NFormItem>
          </NForm>
        </div>
          </div>
        </div>
      </div>
    </Teleport>

    <!-- Data source trigger management panel - Modal pop-up window -->
    <NModal
      v-model:show="showDataSourcePanel"
      :mask-closable="true"
      :close-on-esc="true"
      preset="card"
      class="data-source-trigger-modal"
      :style="{ width: '1000px', maxWidth: '95vw' }"
      :title="$t('dataSource.trigger.title')"
      :bordered="false"
      size="huge"
      role="dialog"
      aria-labelledby="data-source-modal-title"
      :auto-focus="false"
    >
      <DataSourceTriggerPanel />
    </NModal>
  </div>
</template>

<style scoped>
.visual-editor-toolbar {
  width: 100%;
  min-height: 48px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--toolbar-bg);
  border-bottom: 1px solid var(--toolbar-border);
  box-shadow: 0 1px 3px var(--toolbar-shadow);
  position: relative;
  z-index: 10;
  transition:
    background-color 0.3s ease,
    border-color 0.3s ease,
    box-shadow 0.3s ease;
  padding: 0 16px;
}

.toolbar-left {
  flex-shrink: 0;
  min-width: fit-content;
}

.toolbar-right {
  flex-shrink: 0;
  margin-left: auto;
}

/* Button group style */
.btn-group {
  display: flex;
  align-items: center;
  gap: 2px;
  padding: 2px;
  background-color: rgba(255, 255, 255, 0.03);
  border-radius: 6px;
  border: 1px solid transparent;
}

.btn-group:hover {
  background-color: rgba(255, 255, 255, 0.06);
  border-color: var(--toolbar-border);
}

/* Toolbar button hover effect */
.n-button {
  transition: all 0.2s ease;
}

.n-button:hover {
  transform: translateY(-1px);
}

/* Split line optimization */
.n-divider--vertical {
  height: 20px;
  margin: 0 8px;
  opacity: 0.6;
}

/* ðŸŽ¨ Ordinary pop-up window style - Remove all transparency effects */
.config-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  /* Restore normal mouse events */
  pointer-events: auto;
}

.config-modal-container {
  width: 800px;
  max-width: 90vw;
  max-height: 85vh;
  background: white;
  border-radius: 8px;
  border: 1px solid #d9d9d9;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Dark theme adaptation */
[data-theme="dark"] .config-modal-container {
  background: #2d2d30;
  border: 1px solid #444;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.config-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.03);
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  flex-shrink: 0;
}

[data-theme="dark"] .config-modal-header {
  background: rgba(255, 255, 255, 0.02);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.config-modal-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--text-color);
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text-color);
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s ease;
  padding: 4px 8px;
  border-radius: 4px;
}

.close-btn:hover {
  opacity: 1;
  background: rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] .close-btn:hover {
  background: rgba(255, 255, 255, 0.05);
}

.config-modal-body {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  background: transparent;
  /* Make sure there is enough space in the scroll area */
  min-height: 0;
  /* Add custom scroll bar style */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
}

/* Custom scroll bar style */
.config-modal-body::-webkit-scrollbar {
  width: 6px;
}

.config-modal-body::-webkit-scrollbar-track {
  background: transparent;
}

.config-modal-body::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 3px;
}

.config-modal-body::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.3);
}

/* Scroll bar in dark theme */
[data-theme="dark"] .config-modal-body::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .config-modal-body::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* Enhanced form content transparency */
.config-modal-body .gridstack-config,
.config-modal-body .canvas-config,
.config-modal-body .visualization-config {
  background: transparent;
  /* Make sure there is enough space at the bottom */
  padding-bottom: 20px;
}

/* Make dividers transparent */
.config-modal-body :deep(.n-divider) {
  border-color: rgba(0, 0, 0, 0.03) !important;
  opacity: 0.6;
}

[data-theme="dark"] .config-modal-body :deep(.n-divider) {
  border-color: rgba(255, 255, 255, 0.05) !important;
  opacity: 0.4;
}

/* Make form components transparent */
.config-modal-body .text-gray-600 {
  opacity: 0.7;
}

/* Selector uses default style - No need to force coverage */

/* Remove all forced style overrides */

/* All mandatory styles have been removedï¼Œuse Naive UI Default style */

/* Data source trigger management modal pop-up window style */
.data-source-trigger-modal {
  --n-border-radius: 12px;
}

.data-source-trigger-modal :deep(.n-modal-mask) {
  background-color: rgba(0, 0, 0, 0.4) !important;
  backdrop-filter: blur(6px) !important;
  -webkit-backdrop-filter: blur(6px) !important;
}

.data-source-trigger-modal :deep(.n-modal-container) {
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
}

.data-source-trigger-modal :deep(.n-card) {
  background-color: var(--modal-bg) !important;
  backdrop-filter: blur(16px) !important;
  -webkit-backdrop-filter: blur(16px) !important;
  box-shadow: 0 8px 32px var(--toolbar-shadow) !important;
  border: 1px solid var(--modal-border) !important;
}

.data-source-trigger-modal :deep(.n-card-header) {
  background-color: var(--modal-header-bg) !important;
  backdrop-filter: blur(12px) !important;
  -webkit-backdrop-filter: blur(12px) !important;
  border-bottom: 1px solid var(--modal-header-border) !important;
}

.data-source-trigger-modal :deep(.n-card-content) {
  background-color: var(--modal-content-bg) !important;
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
  padding: 16px !important;
}



.dialog-actions {
  border-top: 1px solid var(--border-color);
  padding-top: 16px;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
  /* medium screenï¼šHide part of button text */
  .btn-group .n-button .n-button__content {
    padding: 0 8px;
  }
}

@media (max-width: 768px) {
  .visual-editor-toolbar {
    padding: 0 8px;
    height: auto;
    min-height: 48px;
  }

  /* small screenï¼šShow only icons */
  .toolbar-left span {
    display: none;
  }

  .btn-group {
    gap: 1px;
    padding: 1px;
  }

  .renderer-config-modal {
    margin: 8px;
    width: calc(100vw - 16px) !important;
  }

  .config-content {
    max-height: 50vh;
  }

  /* If the space is too smallï¼ŒhideCanvasUnique controls */
  .btn-group:has(+ .btn-group) {
    display: none;
  }
}

@media (max-width: 480px) {
  /* super small screenï¼šSimplify further */
  .toolbar-right .n-space {
    gap: 2px !important;
  }

  .btn-group:nth-child(n + 3) {
    display: none;
  }
}
</style>
